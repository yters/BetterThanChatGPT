<!DOCTYPE html>
<html>
<head>
<style>
  .announcement {
    border: 1px solid gray;
    margin-left: auto;
    margin-right: auto;
    width: 90%;
    background-color: #d0f0f6;
    text-align: left;
    padding: 8px;
  }
  #prop_true {
    background-color: lightgreen
  }
  #prop_false {
    background-color: pink
  }
  table, th, td {
    border: 1px solid;
    text-align: center;
  }
  span.true {
    color: darkgreen;
    font-weight: bold;
  }
  span.false {
    color: darkred;
    font-weight: bold;
  }
</style>
<script src="evaluateLogic2.js"></script> 
<script>
  var url = new URL(window.location.href);
  var data = {};
  console.log("'" + url.search + "'");
  data.props = [];
  data.conds = [];
  if (url.search != "") {
    let props_list = Proposition.buildFrom(decodeURI(window.location.search.slice(1)));
    if (props_list) {
      for (let i = 0; i < props_list.length; i++) {
        if (props_list[i] instanceof Conditional) {
          data.conds.push(props_list[i]);
        } else {
          data.props.push(props_list[i]);
        }
      }
    }
  }

  function setURL() {
    url.search = "?" + encodeURI(data.props.map(({name}) => name).join("&&") + "&&" + data.conds.map(({name}) => name).join("&&"));
    history.replaceState(null, "", url.search);
    document.getElementById('shareable_link').href = "https://yters.github.io/BetterThanChatGPT/index.html" + url.search;
  }

  function updateProps() {
    setURL();
    let tbody = "";
    let i = 0;
    for (const prop of data.props) {
      if (i == data.props.length - 1) {
        tbody += "<tr><th colspan='2'><em>Conclusion</em></th></tr>";
      }
      tbody += "<tr><td>" + (prop instanceof Negation ? '<span class="false">' + prop.getName() + '</span>' : '<span class="true">' + prop.getName() + '</span>') + "</td>" +
        "<td><button class='delete' onclick='deleteProp(" + i + ");''>Del</button></td></tr>";
      i++;
    }
    document.getElementById("list_props").querySelector('tbody').innerHTML = tbody;
    updateEvaluation();
  }

  function updateConds() {
    setURL();
    let tbody = "";
    let i = 0;
    for (const cond of data.conds) {
      tbody += "<tr><td>" + cond.getName() + '"</td>' +
        "<td><button class='delete' onclick='deleteCond(" + i + ");''>Del</button></td></tr>";
      i++;
    }
    document.getElementById("list_conds").querySelector('tbody').innerHTML = tbody;
    updateEvaluation();
  }
  
  function addProp(negated) {
    let prop = new Claim(document.getElementById('prop_input').value);
    if (negated) prop = new Negation(prop);
    data.props.push(prop);
    updateProps();
  }

  function addCond() {
    let ante = new Claim(document.getElementById('cond_ante').value);
    let cons = new Claim(document.getElementById('cond_cons').value);
    if (document.getElementById('cond_ante_true').value == "false") ante = new Negation(ante);
    if (document.getElementById('cond_cons_true').value == "false") cons = new Negation(cons);
    let cond = new Conditional(ante, cons);
    data.conds.push(cond);
    updateConds();
  }

  function deleteProp(number) {
    data.props.splice(number, 1);
    updateProps();
  }

  function deleteCond(number) {
    data.conds.splice(number, 1);
    updateConds();
  }

  function evaluateAll() {
    if (data.props.length < 1 || data.props.length + data.conds.length < 2) {
      alert("At least one proposition (ie. the conclusion) and at least one other proposition or condition are required.");
    } else {
      updateEvaluation();
    }
  }

  function updateEvaluation() {
    let outcome = document.getElementById("outcome");
    let evaluation = evaluateLogic(data.props.slice(0, -1).concat(data.conds), data.props.at(-1));
    let timeMessage = " (" + evaluation.runTime.toPrecision(3) + "ms)";
    if (evaluation.contradiction) {
      outcome.innerHTML = "Axioms are contradictory, so anything follows." + timeMessage;
    } else if (evaluation.tautology) {
      outcome.innerHTML = "Conclusion follows from axioms." + timeMessage;
    } else {
      outcome.innerHTML = "Axioms do not imply conclusion." + timeMessage;
    }
    /*let evaluation_contradiction = document.getElementById("evaluation_contradiction");
    if (evaluation.contradiction) {
      evaluation_contradiction.innerHTML = "True";
    } else {
      evaluation_contradiction.innerHTML = "False";
    }
    let evaluation_tautology = document.getElementById("evaluation_tautology");
    if (evaluation.tautology) {
      evaluation_tautology.innerHTML = "True";
    } else {
      evaluation_tautology.innerHTML = "False";
    }*/
  }

  /*function clearEvaluation(evaluation) {
    let outcome = document.getElementById("outcome");
    outcome.innerHTML = "Uknown.";
    let evaluation_contradiction = document.getElementById("evaluation_contradiction");
    evaluation_contradiction.innerHTML = "Unknown";
    let evaluation_tautology = document.getElementById("evaluation_tautology");
    evaluation_tautology.innerHTML = "Unknown";
  }*/

</script>
</head>
<body onload="updateProps(); updateConds(); document.getElementById('reset_link').href = url.origin + url.path;">

<div class="announcement">
  <h1>Evaluate Logic</h1>
  <p></p>
</div>

<div>
<p>
  Proposition: <input type="text" id="prop_input" value="all crows are black"></input> is 
  <button id="prop_true" onclick="addProp(false)">TRUE</button> / <button id="prop_false" onclick="addProp(true)">FALSE</button>
</p>
</div>
<div>
  <table id="list_props">
    <thead><tr><th>Proposition</th></th><th>Actions</th></tr></thead>
    <tbody>
      <tr><td>all ravens are black</td><td></td></tr>
    </tbody>
  </table>
</div>
<div>
  <p>
    Condition: 
    <select id="cond_ante_true" value="If">
      <option value="true">If</option>
      <option value="false">If not</option>
    </input> 
    <input type="text" id="cond_ante" value="all crows are black"></input> 
    <select id="cond_cons_true" value="then">
      <option value="true">then</option>
      <option value="false">then not</option>
    </input> 
    <input type="text" id="cond_cons" value="all ravens are black"></input>
    <button id="cond_add" onclick="addCond()">ADD</button>
  </p>
</div>
<div>
  <table id="list_conds">
    <thead><tr><th>Condition</th><th>Actions</th></tr></thead>
    <tbody>
      <tr><td>If "all crows are black" then <span class="false">not</span> "all ravens are black"</td><td></td></tr>
    </tbody>
  </table>
</div>
<div>
  <p>
    <b>
      Evaluation:
    </b>
  </p>
  <p>
    <u id="outcome">
      Unknown.
    </u>
  </p>
  <!--<table id="evaluation_properties">
    <thead><tr><th>Property</th><th>Value</th></tr></thead>
    <tbody>
      <tr><td>Axioms form contradiction</td><td id="evaluation_contradiction">Unknown</td></tr>
      <tr><td>Argument is a tautology</td><td id="evaluation_tautology">Unknown</td></tr>
    </tbody>
  </table>-->
<div>
  <p><button class="evaluate" onclick="evaluateAll();">Evaluate!</button> <a id="shareable_link" href="">Shareable Link</a> <a id="reset_link" href="">Start Over</a></p>
</div>
</body>
</html>
