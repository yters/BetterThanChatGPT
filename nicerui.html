<!DOCTYPE html>
<html>
<head>
<style>
  .announcement {
    border: 1px solid gray;
    margin-left: auto;
    margin-right: auto;
    width: 90%;
    background-color: #d0f0f6;
    text-align: left;
    padding: 8px;
  }
  #prop_true {
    background-color: lightgreen
  }
  #prop_false {
    background-color: pink
  }
  table, th, td {
    border: 1px solid;
  }
  span.true {
    color: darkgreen;
    font-weight: bold;
  }
  span.false {
    color: darkred;
    font-weight: bold;
  }
</style>
<script src="evaluateLogic.js"></script> 
<script>
  var data = {};
  //console.log("'" + document.cookie + "'");
  let result = document.cookie.match(new RegExp('data=([^;]+)'));
  if (result) {
    data = JSON.parse(result[1]);
  } else {
    data.props = [];
    data.conds = [];
  }

  function setCookies() {
    document.cookie = ["data", '=', JSON.stringify(data), ';', window.location.host.toString(), ';'].join('');
    console.log("'" + ["data", '=', JSON.stringify(data), ';', window.location.host.toString(), ';'].join('') + "'");
    //console.log("'" + document.cookie + "'");
  }

  function updateProps() {
    setCookies();
    let tbody = "";
    let i = 0;
    for (const prop of data.props) {
      tbody += "<tr><td>" + (prop.negated ? '<span class="false">False</span>' : '<span class="true">True</span>') + "</td>" +
        "<td>" + prop.name + "</td>" +
        "<td><button class='delete' onclick='deleteProp(" + i + ");''>Del</button></td></tr>";
      i++;
    }
    document.getElementById("list_props").querySelector('tbody').innerHTML = tbody;
  }

  function updateConds() {
    setCookies();
    let tbody = "";
    let i = 0;
    for (const cond of data.conds) {
      tbody += "<tr><td>" + (cond.antecedent.negated ? 'If <span class="false">not</span>' : 'If') + ' "' + cond.antecedent.name + '"' + 
        " then " + (cond.consequent.negated ? '<span class="false">not</span>' : '') + '"' + cond.consequent.name + '"</td>' +
        "<td><button class='delete' onclick='deleteCond(" + i + ");''>Del</button></td></tr>";
      i++;
    }
    document.getElementById("list_conds").querySelector('tbody').innerHTML = tbody;
  }
  
  function addProp(negated) {
    let prop = new Proposition(negated, document.getElementById('prop_input').value);
    data.props.push(prop);
    updateProps();
  }

  function addCond() {
    let ante = new Proposition(document.getElementById('cond_ante_true').value == "true" ? false : true, document.getElementById('cond_ante').value);
    let cons = new Proposition(document.getElementById('cond_cons_true').value == "true" ? false : true, document.getElementById('cond_cons').value);
    let cond = new Conditional(ante, cons);
    data.conds.push(cond);
    updateConds();
  }

  function deleteProp(number) {
    data.props.splice(number, 1);
    updateProps();
  }

  function deleteCond(number) {
    data.conds.splice(number, 1);
    updateConds();
  }

  function evaluateAll() {
    if (data.props.length < 1 || data.props.length + data.conds.length < 2) {
      alert("At least one proposition (ie. the conclusion) and at least one other proposition or condition are required.");
    } else {
      evaluateLogic(data.props.slice(0, -1).concat(data.conds), data.props.at(-1))
    }
  }

</script>
</head>
<body onload="updateProps(); updateConds()">

<div class="announcement">
  <h1>Evaluate Logic</h1>
  <p></p>
</div>

<div>
<p>
  Proposition: <input type="text" id="prop_input" value="all_crows_are_black"></input> is 
  <button id="prop_true" onclick="addProp(false)">TRUE</button> / <button id="prop_false" onclick="addProp(true)">FALSE</button>
</p>
</div>
<div>
  <table id="list_props">
    <thead><tr><th>True?</th><th>Proposition</th></th><th>Actions</th></tr></thead>
    <tbody>
      <tr><td>False</td><td>all_ravens_are_black</td><td></td></tr>
    </tbody>
  </table>
</div>
<div>
  <p>
    Condition: 
    <select id="cond_ante_true" value="If">
      <option value="true">If</option>
      <option value="false">If not</option>
    </input> 
    <input type="text" id="cond_ante" value="all_crows_are_black"></input> 
    <select id="cond_cons_true" value="then">
      <option value="true">then</option>
      <option value="false">then not</option>
    </input> 
    <input type="text" id="cond_cons" value="all_ravens_are_black"></input>
    <button id="cond_add" onclick="addCond()">ADD</button>
  </p>
</div>
<div>
  <table id="list_conds">
    <thead><tr><th>Condition</th></th><th>Actions</th></tr></thead>
    <tbody>
      <tr><td>If "all_crows_are_black" then <span class="false">not</span> "all_ravens_are_black"</td><td></td></tr>
    </tbody>
  </table>
</div>
<button class="evaluate" onclick="evaluateAll();">Evaluate!</button>
</body>
</html>
